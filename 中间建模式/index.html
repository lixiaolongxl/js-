<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中间建模式</title>
</head>
<body>
    <script>
        // 1、中间件模式（middleware）是一种很常见、也很强大的模式，被广泛应用在 Express、Koa、Redux 等类库和框架当中。如果你能在自己的代码中也使用灵活这种模式能给你的程序带来更大的便利性和灵活性。

        // 2、简单来说，中间件就是在调用目标函数之前，你可以随意插入其他函数预先对数据进行处理、过滤，在这个过程里面你可以打印数据、或者停止往下执行中间件等。数据就像水流一样经过中间件的层层的处理、过滤，最终到达目标函数。

        const app = {
            fns:[],
            callback(ctx){
                console.log(ctx)
            },
            use(fn){
                this.fns.push(fn)
            },
            go(ctx){
                let index = 0;
                const next = ()=>{
                    index++;
                }
                this.fns.map((fn,i)=>{
                    if(index==i){
                        fn(ctx,next)
                    }
                })
                index === this.fns.length && this.callback(ctx);
            }
        }


        app.use((ctx,next)=>{
            ctx.name = 'aaaa'
            next();
        })
        app.use((ctx,next)=>{
            ctx.age = '12'
            next();
        })
        app.use((ctx,next)=>{
            console.log(ctx)
            next();
        })
        app.go({});
    </script>
</body>
</html>